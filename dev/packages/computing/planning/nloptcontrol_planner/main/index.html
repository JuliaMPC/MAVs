<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>nloptcontrol_planner · MAVs</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../../../../assets/documenter.js"></script><script src="../../../../../siteinfo.js"></script><script src="../../../../../../versions.js"></script><link href="../../../../../assets/documenter.css" rel="stylesheet" type="text/css"/><link href="../../../../../assets/style.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>MAVs</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../../../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../../../../">Home</a></li><li><span class="toctext">Usage</span><ul><li><a class="toctext" href="../../../../../tutorials/basic/">Basic usage</a></li><li><a class="toctext" href="../../../../../tutorials/developer/">Developing MAVs</a></li></ul></li><li><span class="toctext">Sensing</span><ul><li><a class="toctext" href="../../../../model/gazebo/vehicle_description/main/">vehicle_description</a></li><li><a class="toctext" href="../../../../model/gazebo/contact_sensor/main/">contact_sensor</a></li></ul></li><li><span class="toctext">Detection</span><ul><li><a class="toctext" href="../../../perception/obstacle_detector/main/">obstacle_detector</a></li></ul></li><li><span class="toctext">Vehicle model</span><ul><li><a class="toctext" href="../../../../model/chrono/ros_chrono/main/">ros_chrono</a></li></ul></li><li><span class="toctext">Planning</span><ul><li class="current"><a class="toctext" href>nloptcontrol_planner</a><ul class="internal"><li><a class="toctext" href="#Inputs-1">Inputs</a></li><li><a class="toctext" href="#Outputs-1">Outputs</a></li><li><a class="toctext" href="#Flags-and-Settings-1">Flags and Settings</a></li><li><a class="toctext" href="#demo-1">demo</a></li></ul></li><li><a class="toctext" href="../../mavs_ros_planner/main/">mavs<em>ros</em>planner</a></li></ul></li><li><span class="toctext">Controller</span><ul><li><a class="toctext" href="../../../controller/path_follower/main/">path_follower</a></li><li><a class="toctext" href="../../../controller/trajectory_follower/main/">trajectory_follower</a></li></ul></li><li><span class="toctext">Miscellaneous</span><ul><li><a class="toctext" href="../../../../system/system_shutdown/">system_shutdown</a></li><li><a class="toctext" href="../../../../system/data_logging/">data_logging</a></li><li><a class="toctext" href="../../../../model/chrono/chrono_position_broadcaster/main/">chrono<em>position</em>broadcaster</a></li><li><a class="toctext" href="../../../perception/point_cloud_converter/">point<em>cloud</em>converter</a></li></ul></li><li><span class="toctext">System demos</span><ul><li><a class="toctext" href="../../../../system/demos/demoI/">demoI</a></li><li><a class="toctext" href="../../../../system/demos/demoM/">demoM</a></li><li><a class="toctext" href="../../../../system/demos/demoK/">demoK</a></li><li><a class="toctext" href="../../../../system/demos/demoZ/">demoZ</a></li></ul></li><li><span class="toctext">Docker</span><ul><li><a class="toctext" href="../../../../../docker/workflow/">Workflow</a></li><li><a class="toctext" href="../../../../../docker/notes/">Notes</a></li></ul></li><li><a class="toctext" href="../../../../../testing/main/">Testing</a></li><li><a class="toctext" href="../../../../../issues/main/">Troubleshooting</a></li></ul></nav><article id="docs"><header><nav><ul><li>Planning</li><li><a href>nloptcontrol_planner</a></li></ul><a class="edit-page" href="https://github.com/JuliaMPC/MAVs/blob/master/docs/src/packages/computing/planning/nloptcontrol_planner/main.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>nloptcontrol_planner</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="nlopcontrol_planner-1" href="#nlopcontrol_planner-1">nlopcontrol_planner</a></h1><p>Obstacle avoidance algorithm described <a href="https://scholar.google.com/citations?user=aJBQ8dwAAAAJ&amp;hl=en">in this paper</a> which can now be solved in real time using an official julia package called <a href="https://github.com/JuliaMPC/NLOptControl.jl">NLOptControl.jl</a>.</p><p>If a vehicle needs to drive quickly and avoid moving obstacles then <code>NLOptControl.jl</code> is well suited to solve the trajectory planning problem. Where <code>A*</code> and <code>OpenPlanner</code> are path planning algorithms and are mostly concerned with satisfying kinematic/geometric constraints, they can identify a path to follow, but without a temporal component, they do not tell you how to follow the path. While, trajectory planning also considers how you can follow the path. So, for instance, what are the optimal steering and throttle trajectories (not simply what are the <code>X</code> and <code>Y</code> waypoints).</p><p><code>NLOptControl.jl</code> is designed as a high level tool, so researchers can easily define their own optimization problems, see my documentation <a href="https://juliampc.github.io/MPCDocs.jl/latest/index.html">here</a>. To do this, <code>nloptcontrol_planner</code> uses the <code>MAVs.jl</code> package. <a href="https://github.com/JuliaMPC/MAVs.jl">MAVs.jl</a> is a <code>julia</code> package that solves an autonomous vehicle motion planning problem using <a href="https://github.com/JuliaMPC/NLOptControl.jl">NLOptControl.jl</a>. There are several different modules, nothing is documented. Read the source code for more info.</p><h2><a class="nav-anchor" id="Inputs-1" href="#Inputs-1">Inputs</a></h2><h3><a class="nav-anchor" id="Obstacles-1" href="#Obstacles-1">Obstacles</a></h3><p>Currently the obstacles are assumed to be represented by circles and their data is to be published to the vectors in the following <code>rosparam</code></p><table><tr><th>Name</th><th>Description</th></tr><tr><td><code>/obstacle/radius</code></td><td>radius of obstacle in (m)</td></tr><tr><td><code>/obstacle/vx</code></td><td>global velocity in global x direction in (m/s)</td></tr><tr><td><code>/obstacle/vy</code></td><td>global velocity in global y direction in (m/s)</td></tr><tr><td><code>/obstacle/x</code></td><td>current global x (m) position of vehicle in (m)</td></tr><tr><td><code>/obstacle/y</code></td><td>current global y (m) position of vehicle in (m)</td></tr></table><h3><a class="nav-anchor" id="Vehicle-State-1" href="#Vehicle-State-1">Vehicle State</a></h3><p>If an actual vehicle is used or an external model of the vehicle is used, <code>/nloptcontrol_planner/flags/3DOF_plant</code> should be set to <code>false</code>. And the following <code>rosparam</code> states (points) should be set:</p><table><tr><th>Name</th><th>Description</th></tr><tr><td><code>/state/x</code></td><td>global x position (m)</td></tr><tr><td><code>/state/y</code></td><td>global y position (m)</td></tr><tr><td><code>/state/psi</code></td><td>global heading angle (rad)</td></tr><tr><td><code>/state/sa</code></td><td>steering angle at the tire (rad)</td></tr><tr><td><code>/state/ux</code></td><td>velocity in the x direction (vehicle frame) in (m/s)</td></tr><tr><td><code>/state/ax</code></td><td>acceleration in the x direction (vehicle frame) in (m/s^s)</td></tr><tr><td><code>/state/r</code></td><td>yaw rate about the z direction in (rad/s)</td></tr></table><h2><a class="nav-anchor" id="Outputs-1" href="#Outputs-1">Outputs</a></h2><h3><a class="nav-anchor" id="Trajectories-1" href="#Trajectories-1">Trajectories</a></h3><p>The purpose of this node is to publish reference state trajectories (vectors) in the <code>Control.msg</code> as</p><table><tr><th>Name</th><th>Description</th></tr><tr><td><code>/trajectory/t</code></td><td>time (s)</td></tr><tr><td><code>/trajectory/x</code></td><td>global x position trajectory (m)</td></tr><tr><td><code>/trajectory/y</code></td><td>global y position trajectory (m)</td></tr><tr><td><code>/trajectory/psi</code></td><td>global heading angle trajectory (rad)</td></tr><tr><td><code>/trajectory/sa</code></td><td>steering angle trajectory at the tire (rad)</td></tr><tr><td><code>/trajectory/ux</code></td><td>speed in the x direction (vehicle frame) (m/s)</td></tr></table><h3><a class="nav-anchor" id="Optimization-and-MPC-message-1" href="#Optimization-and-MPC-message-1">Optimization and MPC message</a></h3><p>The error between the predicted initial state and the actual initial state is provided along with some additional optimization information in the <code>Optimization.msg</code> as</p><p>Type | Name | Description – | –- | –- <code>float64</code> | <code>texP</code>            |           predicted execution horizon (s) <code>float64</code> | <code>texA</code>             |          actual execution horizon (s) <code>float64</code>| <code>tSolve</code>             |        optimization time (s) <code>string</code>| <code>status</code>               |       optimization status <code>float64[]</code> |<code>X0p</code>                |      predicted initial state vector <code>float64[]</code>| <code>X0a</code>                 |     actual initial state vector <code>float64[]</code>| <code>X0e</code>                  |    error in prediction of initial state vector</p><h2><a class="nav-anchor" id="Flags-and-Settings-1" href="#Flags-and-Settings-1">Flags and Settings</a></h2><table><tr><th>Name</th><th>Description</th></tr><tr><td><code>/nloptcontrol_planner/case_name</code></td><td>name of configuration file for solver settings</td></tr><tr><td><code>/nloptcontrol_planner/obstacle_name</code></td><td>name of configuration file for obstacle field</td></tr><tr><td><code>/nloptcontrol_planner/flags/3DOF_plant</code></td><td>indicates if the 3DOF plant model in VehicleModels.jl will be used</td></tr><tr><td><code>/nloptcontrol_planner/flags/init</code></td><td>indicates if the planner has finished initialization</td></tr><tr><td><code>/nloptcontrol_planner/flags/known_environment</code></td><td>indicates if the obstacle information is assumed to be known</td></tr></table><h2><a class="nav-anchor" id="demo-1" href="#demo-1">demo</a></h2><p>A stand-alone demo to show that the <code>NLOptControl.jl</code> is solving the OCP and connected to <code>ROS</code>.</p><h3><a class="nav-anchor" id="To-Run-1" href="#To-Run-1">To Run</a></h3><pre><code class="language-none">roslaunch nloptcontrol_planner demo.launch</code></pre><h3><a class="nav-anchor" id="Expected-Output-1" href="#Expected-Output-1">Expected Output</a></h3><p>After a few minutes the terminal should display:</p><pre><code class="language-none">******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

Running model for the: 0 time
[199.831, 8.44829, -0.304456, 0.225719, 1.62274, 0.0524729, 16.7114, -1.11083]
nloptcontrol_planner has been initialized.
Running model for the: 1 time
[198.976, 16.6123, -0.820356, 0.246638, 1.75329, 0.0330637, 16.1247, -1.22459]
Running model for the: 2 time
[197.441, 24.3947, -0.579523, 0.0349721, 1.8273, -0.00889783, 15.6299, -0.77718]
Running model for the: 3 time
[195.715, 31.9384, -0.0419052, -0.121407, 1.80044, -0.0317296, 15.3501, -0.361812]
Running model for the: 4 time
[194.294, 39.4512, 0.237982, -0.16141, 1.72634, -0.0360165, 15.2689, 0.0185792]
Running model for the: 5 time
[193.395, 47.0487, 0.302376, -0.149562, 1.64747, -0.0328082, 15.3683, 0.361693]
Running model for the: 6 time
[193.034, 54.7811, 0.269118, -0.117383, 1.58031, -0.0253441, 15.6244, 0.646153]
Running model for the: 7 time
[193.132, 62.6823, 0.204767, -0.0873723, 1.52942, -0.0189879, 16.0035, 0.854896]
Running model for the: 8 time
[193.601, 70.7833, 0.149901, -0.0649146, 1.49162, -0.0140566, 16.4672, 0.985584]
Running model for the: 9 time
[194.365, 79.1078, 0.10819, -0.0480866, 1.46356, -0.0102397, 16.9765, 1.03786]
Running model for the: 10 time
goal is in range
[195.357, 87.6683, 0.0590599, -0.020078, 1.44614, -0.00305557, 17.4935, 1.02433]
Running model for the: 11 time
goal is in range
[196.478, 96.4715, -0.0230271, 0.00710531, 1.44323, 0.00253812, 18.002, 1.00652]
Running model for the: 12 time
goal is in range
[197.629, 105.525, -0.100926, 0.0220395, 1.45104, 0.00503927, 18.5022, 0.990981]
Running model for the: 13 time
goal is in range
[198.736, 114.834, -0.150177, 0.027248, 1.46365, 0.00574419, 18.9955, 0.978923]
Running model for the: 14 time
goal is in range
[199.758, 124.4, -0.175388, 0.0281426, 1.47758, 0.00578579, 19.4841, 0.974316]
Goal Attained!

[obstacle_avoidance-2] process has finished cleanly
log file: /home/febbo/.ros/log/f7108cac-2de8-11e8-8052-104a7d04da99/obstacle_avoidance-2*.log</code></pre><p>This indicates a successful test.</p><h3><a class="nav-anchor" id="Notes-1" href="#Notes-1">Notes</a></h3><ul><li>A large optimization problem needs to be initialized</li><li>caching the functions upon start-up takes a few minutes</li></ul><footer><hr/><a class="previous" href="../../../../model/chrono/ros_chrono/main/"><span class="direction">Previous</span><span class="title">ros_chrono</span></a><a class="next" href="../../mavs_ros_planner/main/"><span class="direction">Next</span><span class="title">mavs<em>ros</em>planner</span></a></footer></article></body></html>
