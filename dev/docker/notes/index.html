<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Notes · MAVs</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/><link href="../../assets/style.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>MAVs</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><span class="toctext">Usage</span><ul><li><a class="toctext" href="../../tutorials/basic/">Basic usage</a></li><li><a class="toctext" href="../../tutorials/developer/">Developing MAVs</a></li></ul></li><li><span class="toctext">Sensing</span><ul><li><a class="toctext" href="../../packages/model/gazebo/vehicle_description/main/">vehicle_description</a></li><li><a class="toctext" href="../../packages/model/gazebo/contact_sensor/main/">contact_sensor</a></li></ul></li><li><span class="toctext">Detection</span><ul><li><a class="toctext" href="../../packages/computing/perception/obstacle_detector/main/">obstacle_detector</a></li></ul></li><li><span class="toctext">Vehicle model</span><ul><li><a class="toctext" href="../../packages/model/chrono/ros_chrono/main/">ros_chrono</a></li></ul></li><li><span class="toctext">Planning</span><ul><li><a class="toctext" href="../../packages/computing/planning/nloptcontrol_planner/main/">nloptcontrol_planner</a></li><li><a class="toctext" href="../../packages/computing/planning/mavs_ros_planner/main/">mavs<em>ros</em>planner</a></li></ul></li><li><span class="toctext">Miscellaneous</span><ul><li><a class="toctext" href="../../packages/system/system_shutdown/">system_shutdown</a></li><li><a class="toctext" href="../../packages/system/data_logging/">data_logging</a></li><li><a class="toctext" href="../../packages/model/chrono/chrono_position_broadcaster/main/">chrono<em>position</em>broadcaster</a></li><li><a class="toctext" href="../../packages/model/chrono/ros_chrono_msgs/main/">ros<em>chrono</em>msgs</a></li><li><a class="toctext" href="../../packages/computing/perception/point_cloud_converter/">point<em>cloud</em>converter</a></li></ul></li><li><span class="toctext">System demos</span><ul><li><a class="toctext" href="../../packages/system/demos/demoA/">demoA</a></li><li><a class="toctext" href="../../packages/system/demos/demoB/">demoB</a></li><li><a class="toctext" href="../../packages/system/demos/demoC/">demoC</a></li><li><a class="toctext" href="../../packages/system/demos/demoD/">demoD</a></li><li><a class="toctext" href="../../packages/system/demos/demoE/">demoE</a></li><li><a class="toctext" href="../../packages/system/demos/demoF/">demoF</a></li><li><a class="toctext" href="../../packages/system/demos/demoG/">demoG</a></li><li><a class="toctext" href="../../packages/system/demos/demoH/">demoH</a></li><li><a class="toctext" href="../../packages/system/demos/demoI/">demoI</a></li></ul></li><li><span class="toctext">Docker</span><ul><li><a class="toctext" href="../workflow/">Workflow</a></li><li class="current"><a class="toctext" href>Notes</a><ul class="internal"><li><a class="toctext" href="#Basic-Concepts-1">Basic Concepts</a></li><li><a class="toctext" href="#Dockerfile-Commands-1">Dockerfile Commands</a></li><li><a class="toctext" href="#Docker-Commands-1">Docker Commands</a></li><li><a class="toctext" href="#Docker-examples:-1">Docker examples:</a></li><li><a class="toctext" href="#Docker-hub-1">Docker hub</a></li><li><a class="toctext" href="#Pull-and-run-the-image-from-the-remote-repository-1">Pull and run the image from the remote repository</a></li><li><a class="toctext" href="#Running-out-of-space?-1">Running out of space?</a></li></ul></li></ul></li><li><a class="toctext" href="../../testing/main/">Testing</a></li><li><a class="toctext" href="../../issues/main/">Troubleshooting</a></li></ul></nav><article id="docs"><header><nav><ul><li>Docker</li><li><a href>Notes</a></li></ul><a class="edit-page" href="https://github.com/JuliaMPC/MAVs/blob/master/docs/src/docker/notes.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Notes</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Docker-notes-1" href="#Docker-notes-1">Docker notes</a></h1><h2><a class="nav-anchor" id="Basic-Concepts-1" href="#Basic-Concepts-1">Basic Concepts</a></h2><p>An image is a lightweight, stand-alone, executable package that includes everything needed to run a piece of software, including the code, a runtime, libraries, environment variables, and config files.   Docker Hub: A registry of Docker images. You can think of the registry as a directory of all available Docker images. Since the image doesn&#39;t exist locally, the client will first fetch the image from the registry and then run the image.   Container: A runtime instance of an image. This is a image becomes in memory when actually executed.   Dockerfile: A simple text-file that contains a list of commands that the Docker client calls while creating an image. It&#39;s a simple way to automate the image creation process.   In an image, a layer is modification to the image, represented by an instruction in the Dockerfile. Layers are applied in sequence to the base image to create the final image. When an image is updated or rebuilt, only layers that change need to be updated, and unchanged layers are cached locally.  </p><h2><a class="nav-anchor" id="Dockerfile-Commands-1" href="#Dockerfile-Commands-1">Dockerfile Commands</a></h2><table><tr><th>Command</th><th>Description</th></tr><tr><td>FROM</td><td>Load from a base image</td></tr><tr><td>CMD</td><td>Cmd takes the following format CMD [“excutable”, ”params1”, ”params2”]</td></tr><tr><td>RUN</td><td>Run is used to execute any commands.</td></tr><tr><td>COPY</td><td>Copy the folder/ files from the local host source to the destination in the container.</td></tr><tr><td>ENV</td><td>Set the environment variables.</td></tr><tr><td>USER</td><td>Set the (UID) username which is to run the container based on the image being built.</td></tr><tr><td>VOLUME</td><td>Enable access from your container to a directory on the host machine.</td></tr></table><h2><a class="nav-anchor" id="Docker-Commands-1" href="#Docker-Commands-1">Docker Commands</a></h2><table><tr><th>Command</th><th>Description</th></tr><tr><td>docker run &lt;image&gt;</td><td>run a docker container based on the image</td></tr><tr><td>docker ps</td><td>show all containers that are currently running</td></tr><tr><td>docker ps -a</td><td>show a list of all containers that we ran</td></tr><tr><td>docker history &lt;image&gt;</td><td>view all the layers that make up the image once the image is built</td></tr><tr><td>docker exec -it &lt;container&gt; /bin/bash</td><td>launch the docker from other terminals</td></tr><tr><td>docker commit &lt;container&gt; &lt;repository[:TAG]&gt;</td><td>create a new image from a container’s changes</td></tr><tr><td>docker kill &lt;container&gt;</td><td>kill one or more running containers</td></tr><tr><td>docker rm &lt;container&gt;</td><td>remove existing container</td></tr><tr><td>docker image ls</td><td>list image built on the machine</td></tr><tr><td>docker image rm &lt;container&gt;</td><td>remove image</td></tr></table><p>nvidia-docker build -t &lt;container&gt; -f &lt;Dockerfile&gt; nvidia-docker run -it –rm 		automatically remove the container when it exits. –volume list	bind mount a volume –env list		set environment variables -u		user or UID (i.e. mavs) –privileged	give extended privileges to this container</p><h2><a class="nav-anchor" id="Docker-examples:-1" href="#Docker-examples:-1">Docker examples:</a></h2><h3><a class="nav-anchor" id="Save-changes-made-in-docker-container:-1" href="#Save-changes-made-in-docker-container:-1">Save changes made in docker container:</a></h3><ol><li>Find the container ID  </li></ol><pre><code class="language-none">$docker ps -l</code></pre><ol><li>Commit the change</li></ol><pre><code class="language-none">$docker commit &lt;container_id&gt; [repository[:tag]]`</code></pre><ol><li>Change the docker name tag in ./run.sh  </li></ol><h3><a class="nav-anchor" id="Upload-base-image-to-Docker-Hub:-1" href="#Upload-base-image-to-Docker-Hub:-1">Upload base image to Docker Hub:</a></h3><ol><li>Tag the image</li></ol><pre><code class="language-none">$docker tag &lt;container&gt; [DockerUserName/Repository[:tag]]</code></pre><ol><li>Push the image to Docker Hub repository</li></ol><pre><code class="language-none">$docker push [DockerUserName/Repository[:tag]]</code></pre><h3><a class="nav-anchor" id="Open-up-new-terminals-to-access-Container-(example):-1" href="#Open-up-new-terminals-to-access-Container-(example):-1">Open up new terminals to access Container (example):</a></h3><ol><li>Look at the current containers available with </li></ol><pre><code class="language-none">$docker container ls</code></pre><pre><code class="language-none">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
ce4096e14bef        mavs                &quot;/ros_entrypoint.sh …&quot;   34 minutes ago      Up 34 minutes                           vigilant_johnson</code></pre><ol><li>Open a new terminal</li></ol><pre><code class="language-none">$docker exec -it vigilant_johnson /bin/bash</code></pre><p>Note: you can use “tab” key to auto-complete the &lt;container_name&gt;</p><h2><a class="nav-anchor" id="Docker-hub-1" href="#Docker-hub-1">Docker hub</a></h2><h3><a class="nav-anchor" id="How-to-update-base-image-on-docker-hub-1" href="#How-to-update-base-image-on-docker-hub-1">How to update base image on docker hub</a></h3><ol><li>Run</li></ol><pre><code class="language-none">$sh build.sh</code></pre><ol><li>login to docker</li></ol><pre><code class="language-none">$docker login</code></pre><ol><li>ensure the name of the image</li></ol><pre><code class="language-none">$docker image ls</code></pre><p>Currently this should be avpg_base, where the image name is specified in the <code>build.sh</code> script</p><ol><li>tag the image</li></ol><pre><code class="language-none">$docker tag avpg_base avpg/cain:base_cudagl</code></pre><p>assuming that the image name is avpg_base</p><ol><li>publish the image</li></ol><pre><code class="language-none">$docker push avpg/cain:base_cudagl</code></pre><p>see the <a href="https://docs.docker.com/get-started/part2/#build-the-app">docker tutorial on containers</a> for more detailed instructions</p><h2><a class="nav-anchor" id="Pull-and-run-the-image-from-the-remote-repository-1" href="#Pull-and-run-the-image-from-the-remote-repository-1">Pull and run the image from the remote repository</a></h2><p>It would be interesting to try this with the higher-level image, but this is <em>not yet tested</em>.</p><pre><code class="language-none">docker run -p 4000:80 avpg/cain:base_cudagl</code></pre><h2><a class="nav-anchor" id="Running-out-of-space?-1" href="#Running-out-of-space?-1">Running out of space?</a></h2><p>Check your current images:</p><pre><code class="language-none">docker image ls</code></pre><p>Check your current containers:</p><pre><code class="language-none">docker image ls</code></pre><p>Do some trimming</p><pre><code class="language-none">docker image prune
docker container prune</code></pre><footer><hr/><a class="previous" href="../workflow/"><span class="direction">Previous</span><span class="title">Workflow</span></a><a class="next" href="../../testing/main/"><span class="direction">Next</span><span class="title">Testing</span></a></footer></article></body></html>
